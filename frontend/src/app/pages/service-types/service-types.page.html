<div class="container mx-auto p-6">
  <!-- Header -->
  <div class="mb-6">
    <div class="flex items-center justify-between mb-4">
      <div class="flex items-center gap-2">
        <h1 class="text-3xl font-bold text-gray-900">Service Types</h1>
        <app-help-manual [sectionId]="'service-types'"></app-help-manual>
      </div>
      <p-button
        *ngIf="isSuperAdmin()"
        label="Add Service Type"
        icon="pi pi-plus"
        (onClick)="openAddDialog()"
      />
    </div>
  </div>

  <div class="mb-4" *ngIf="isSuperAdmin()">
    <label class="block text-sm font-medium mb-1">Owner</label>
    <p-dropdown
      [options]="ownerFilterOptions()"
      optionLabel="label"
      optionValue="value"
      [ngModel]="ownerFilterId()"
      (ngModelChange)="ownerFilterId.set($event); loadData()"
      placeholder="All owners"
      class="w-80"
    />
  </div>

  <!-- Table -->
  <p-table
    [value]="items()"
    [loading]="loading()"
    [paginator]="false"
    styleClass="p-datatable-striped"
  >
    <ng-template pTemplate="header">
      <tr>
        <th>ID</th>
        <th>Code</th>
        <th>Name</th>
        <th>Owner</th>
        <th>Description</th>
        <th>Status</th>
        <th>Actions</th>
      </tr>
    </ng-template>
    <ng-template pTemplate="body" let-item>
      <tr>
        <td class="font-mono text-sm">{{ item.id }}</td>
        <td class="font-mono font-semibold">{{ item.code }}</td>
        <td>{{ item.name }}</td>
        <td>{{ item.ownerName || 'Unassigned' }}</td>
        <td>{{ item.description || 'â€”' }}</td>
        <td>
          <span
            [class]="
              item.isActive
                ? 'px-2 py-1 text-xs font-semibold rounded bg-green-100 text-green-800'
                : 'px-2 py-1 text-xs font-semibold rounded bg-gray-100 text-gray-800'
            "
          >
            {{ item.isActive ? 'Active' : 'Inactive' }}
          </span>
        </td>
        <td>
          <p-button
            *ngIf="isSuperAdmin()"
            icon="pi pi-pencil"
            [text]="true"
            [rounded]="true"
            (onClick)="openEditDialog(item)"
          />
          <span *ngIf="!isSuperAdmin()" class="text-gray-400 text-sm">Read-only</span>
        </td>
      </tr>
    </ng-template>
    <ng-template pTemplate="emptymessage">
      <tr>
        <td colspan="7" class="text-center text-gray-500 py-4">
          No service types found.
        </td>
      </tr>
    </ng-template>
  </p-table>

  <!-- Add/Edit Dialog -->
  <p-dialog
    [(visible)]="showDialogValue"
    [header]="isEditMode() ? 'Edit Service Type' : 'Add Service Type'"
    [modal]="true"
    [style]="{ width: '500px' }"
    [appendTo]="'body'"
    [baseZIndex]="10000"
    (onHide)="showDialog.set(false)"
  >
    <div class="flex flex-col gap-4">
      <div>
        <label class="block text-sm font-medium mb-1">Owner *</label>
        <p-dropdown
          [options]="owners()"
          optionLabel="name"
          optionValue="id"
          [ngModel]="form().ownerId"
          (ngModelChange)="updateForm({ ownerId: $event })"
          placeholder="Select owner"
          class="w-full"
        />
      </div>
      <div>
        <label class="block text-sm font-medium mb-1">Code *</label>
        <input
          pInputText
          [(ngModel)]="form().code"
          placeholder="e.g., CHARGING_POST"
          class="w-full"
        />
        <p class="text-xs text-gray-500 mt-1">
          Uppercase, alphanumeric, underscores only
        </p>
      </div>
      <div>
        <label class="block text-sm font-medium mb-1">Name *</label>
        <input
          pInputText
          [(ngModel)]="form().name"
          placeholder="e.g., Charging Posts"
          class="w-full"
        />
      </div>
      <div>
        <label class="block text-sm font-medium mb-1">Description</label>
        <input
          pInputText
          [(ngModel)]="form().description"
          placeholder="Optional description"
          class="w-full"
        />
      </div>
      <div class="flex items-center gap-2">
        <p-checkbox
          [binary]="true"
          [ngModel]="form().isActive"
          (ngModelChange)="updateForm({ isActive: $event })"
          inputId="serviceTypeActive"
        ></p-checkbox>
        <label for="serviceTypeActive" class="text-sm">Active</label>
      </div>
    </div>
    <ng-template pTemplate="footer">
      <p-button
        label="Cancel"
        severity="secondary"
        (onClick)="showDialog.set(false)"
      />
      <p-button
        label="Save"
        (onClick)="save()"
        [loading]="loading()"
      />
    </ng-template>
  </p-dialog>

  <p-toast />
</div>

