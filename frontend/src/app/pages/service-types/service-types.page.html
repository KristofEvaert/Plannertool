<div class="container mx-auto p-6">
  <!-- Header -->
  <div class="mb-6">
    <div class="flex items-center justify-between mb-4">
      <div class="flex items-center gap-2">
        <h1 class="text-3xl font-bold text-gray-900">Service Types</h1>
        <app-help-manual [sectionId]="'service-types'" />
      </div>
      @if (isSuperAdmin()) {
        <p-button label="Add Service Type" icon="pi pi-plus" (onClick)="openAddDialog()" />
      }
    </div>
  </div>

  @if (isSuperAdmin()) {
    <div class="mb-4">
      <label class="block text-sm font-medium mb-1">Owner</label>
      <p-select
        optionLabel="label"
        optionValue="value"
        placeholder="All owners"
        class="w-80"
        [options]="ownerFilterOptions()"
        [ngModel]="ownerFilterId()"
        (ngModelChange)="ownerFilterId.set($event); loadData()"
      />
    </div>
  }

  <!-- Table -->
  <p-table
    styleClass="p-datatable-striped"
    [value]="items()"
    [loading]="loading()"
    [paginator]="false"
  >
    <ng-template pTemplate="header">
      <tr>
        <th>ID</th>
        <th>Code</th>
        <th>Name</th>
        <th>Owner</th>
        <th>Description</th>
        <th>Status</th>
        <th>Actions</th>
      </tr>
    </ng-template>
    <ng-template let-item pTemplate="body">
      <tr>
        <td class="font-mono text-sm">{{ item.id }}</td>
        <td class="font-mono font-semibold">{{ item.code }}</td>
        <td>{{ item.name }}</td>
        <td>{{ item.ownerName || 'Unassigned' }}</td>
        <td>{{ item.description || 'â€”' }}</td>
        <td>
          <span
            [class]="
              item.isActive
                ? 'px-2 py-1 text-xs font-semibold rounded bg-green-100 text-green-800'
                : 'px-2 py-1 text-xs font-semibold rounded bg-gray-100 text-gray-800'
            "
          >
            {{ item.isActive ? 'Active' : 'Inactive' }}
          </span>
        </td>
        <td>
          @if (isSuperAdmin()) {
            <p-button
              icon="pi pi-pencil"
              [text]="true"
              [rounded]="true"
              (onClick)="openEditDialog(item)"
            />
          }
          @if (!isSuperAdmin()) {
            <span class="text-gray-400 text-sm">Read-only</span>
          }
        </td>
      </tr>
    </ng-template>
    <ng-template pTemplate="emptymessage">
      <tr>
        <td colspan="7" class="text-center text-gray-500 py-4">No service types found.</td>
      </tr>
    </ng-template>
  </p-table>

  <!-- Add/Edit Dialog -->
  <p-dialog
    [header]="isEditMode() ? 'Edit Service Type' : 'Add Service Type'"
    [modal]="true"
    [style]="{ width: '500px' }"
    [appendTo]="'body'"
    [baseZIndex]="10000"
    (onHide)="showDialog.set(false)"
    [(visible)]="showDialogValue"
  >
    <div class="flex flex-col gap-4">
      <div>
        <label class="block text-sm font-medium mb-1">Owner *</label>
        <p-select
          optionLabel="name"
          optionValue="id"
          placeholder="Select owner"
          class="w-full"
          [options]="owners()"
          [ngModel]="form().ownerId"
          (ngModelChange)="updateForm({ ownerId: $event })"
        />
      </div>
      <div>
        <label class="block text-sm font-medium mb-1">Code *</label>
        <input
          pInputText
          placeholder="e.g., CHARGING_POST"
          class="w-full"
          [(ngModel)]="form().code"
        />
        <p class="text-xs text-gray-500 mt-1">Uppercase, alphanumeric, underscores only</p>
      </div>
      <div>
        <label class="block text-sm font-medium mb-1">Name *</label>
        <input
          pInputText
          placeholder="e.g., Charging Posts"
          class="w-full"
          [(ngModel)]="form().name"
        />
      </div>
      <div>
        <label class="block text-sm font-medium mb-1">Description</label>
        <input
          pInputText
          placeholder="Optional description"
          class="w-full"
          [(ngModel)]="form().description"
        />
      </div>
      <div class="flex items-center gap-2">
        <p-checkbox
          inputId="serviceTypeActive"
          [binary]="true"
          [ngModel]="form().isActive"
          (ngModelChange)="updateForm({ isActive: $event })"
        />
        <label for="serviceTypeActive" class="text-sm">Active</label>
      </div>
    </div>
    <ng-template pTemplate="footer">
      <p-button label="Cancel" severity="secondary" (onClick)="showDialog.set(false)" />
      <p-button label="Save" [loading]="loading()" (onClick)="save()" />
    </ng-template>
  </p-dialog>

  <p-toast />
</div>
